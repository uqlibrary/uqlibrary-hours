<!--
Element providing an overview for current libraries working hours

##### Example

    <uqlibrary-hours></uqlibrary-hours>

    <script>
    (function () {

      window.addEventListener('polymer-ready', function() {

        var hours = document.querySelector('uqlibrary-hours');

        hours.hours = [

          ];
      });
    }());
  </script>

@element uqlibrary-hours
@blurb Element providing an overview for current libraries working hours
@status alpha
@homepage http://uqlibrary.github.io/uqlibrary-hours
-->

<link rel="import" href="../uqlibrary-elements/0.5.3/lib/vulcanized.html">



<polymer-element name="uqlibrary-hours" layout center attributes="hours autoload">
  <template>
    <link rel="stylesheet" href="uqlibrary-hours.css">
    <uqlibrary-api-account id="account"></uqlibrary-api-account>
    <uqlibrary-api-library-hours id="hoursApi"></uqlibrary-api-library-hours>
    <uqlibrary-ga id="ga" appName="Hours"></uqlibrary-ga>

    <core-drawer-panel id="drawerPanel" drawerWidth="256px" responsiveWidth="768px">
      <core-header-panel drawer id="drawer">
        <uqlibrary-menu account="{{user}}"></uqlibrary-menu>
      </core-header-panel>

      <core-header-panel main id="main">
        <core-toolbar>
          <paper-icon-button id="toolBarLeftButton" icon="menu" core-drawer-toggle></paper-icon-button>
          <span flex id="toolbar-page-title">Library Hours</span>

        </core-toolbar>

        <div id="content">
          <ul class="three-line-list">
            <li class="gap"></li>
            <core-list id="list" data="{{hours}}" fit>
              <template>
                <li class="list-item border">
                  <div class="content">
                    <paper-ripple fit></paper-ripple>
                    <div class="line1">{{model.name}}</div>
                    <div class="line2">

                    </div>
                    <div class="line3" >{{model.times}}</div>
                  </div>
                </li>
          </template>
          </core-list>
          </ul>
        </div>
      </core-header-panel>

    </core-drawer-panel>

  </template>

  <script>
    Polymer('uqlibrary-hours', {

      /**
       * The `hours` attribute contains information about hours
       *
       * @property hours
       * @type Object
       */

      publish: {
        hours: null,
        autoload: true
      },
      user: {},

      ready: function() {
        var that = this;

        this.$.account.addEventListener('uqlibrary-api-account-loaded', function(e) {
          if (e.detail.hasSession) {
            if(e.detail.classes) {
              that.user = e.detail;
            }
          }
        });

        this.$.hoursApi.addEventListener('uqlibrary-api-library-hours', function(e) {
          that.hours = e.detail;
        });
        if(this.autoload){
          this.$.hoursApi.get();
        }
      },

      hoursChanged: function() {
        if(this.hours.length > 0 ) {
          var dayString = moment().format('YYYY-MM-DD');
          var _open, _close, _diff;
          for(var i = 0; i < this.hours.length; i++) {
            _open = moment(dayString+ ' ' + this.hours[i].open);
            _close = moment(dayString+ ' ' + this.hours[i].close);
            _diff = _close.diff(_open, 'hours');
            if(_diff == 24) {
              this.hours[i].times = 'Open 24 hours';
            }
            else if( _diff == 0) {
              this.hours[i].times = 'Closed';
            }
            else {
              this.hours[i].times = _open.format("h:mm a") + ' - ' + _close.format("h:mm a");
            }
          }
        }
      }



    });
  </script>

</polymer-element>